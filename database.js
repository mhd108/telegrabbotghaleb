const fs = require('fs');
const path = require('path');

const DB_FILE = path.join(__dirname, 'db.json');

// --- HARDCODED CONTENT (Resistant to Server Restarts) ---
const FIXED_SECTIONS = [
    {
        id: 'intro_learn_to_win',
        title: '๐ก ุดู ูู Learn to Winุ',
        content: 'ูู ููุงุฉ ูุจูุช ููุนูู ุนุจุฑ ุงูุฅูุชุฑูุชุ ูุฎุตุตุฉ ูููุงุณ ููู ุจุฏูุง ุชุดุชุบู ุดุบู ูุถูู ููุงุถุญุ ุจุฏูู ุจุซูุซุ ุจุฏูู ููุงููุงุชุ ุจุฏูู ุฑุณุงุฆูุ ูุจุฏูู ูุฑุงููุงุช ุฃู ูุตุจ.\nุงูุดุบู ูุงุฆู ุนูู ุชูููุฐ ููุงู ุญููููุฉ ููุฌุฑูุจุฉุ ูุงููุฑุฏูุฏ ุญุณุจ ุงุฌุชูุงุฏู ูุงูุชุฒุงูู.'
    },
    {
        id: 'faq_1_field',
        title: '1๏ธโฃ ุดู ูู ูุฌุงู ุงูุดุบูุ',
        content: 'ูุฌุงู ุงูุดุบู ูู CPA (Cost Per Action)\nูุนูู ุจุชุฑุจุญ ููุงุจู ุชูููุฐ ููุงู ุจุณูุทุฉุ ูู ุจูุน ุฃู ุฏูุน ูุตุงุฑู.\n\nุงูููุงู ูุชู:\nโข ุชุณุฌูู ุญุณุงุจ ุจ ุชุทุจูู ุงู ูููุน\nโข ุชุญููู ุชุทุจูู\nโข ุชุซุจูุช ูุนุจุฉ ูุชูุตู ููุง ู ููู ูุนูู\n\nุงูุช ูุง ุฎุณุฑุช ุดู ูุฃุฎุฏุช ุนูููุชู.'
    },
    {
        id: 'faq_2_legit',
        title: '2๏ธโฃ ูู ุงููุฌุงู ุญูููู ููุง ูุตุจุ',
        content: 'ุงููุฌุงู ุญูููู ูุดุฑุนู 100%ุ ูุดุฑูุงุช ุนุงูููุฉ ุดุบูุงูุฉ ููู ูู ุณููู.\n\nุงูุฎุณุงุฑุฉ ุฃู ุงูุญุธุฑ ูุง ุจุชููู ุจุณุจุจ ุงููุฌุงูุ ุจุชููู ุจุณุจุจ ุทุฑููุฉ ุงูุงุณุชุฎุฏุงู.\n\nุฅุฐุง ุงููุณุชุฎุฏู:\nโข ุบุด ุฃู ุญุงูู ูุชุญุงูู\nโข ุงุณุชุฎุฏู VPN / Proxy ุจุทุฑููุฉ ุฎุงุทุฆุฉ\nโข ุฎุงูู ุดุฑูุท ุงูุนุฑูุถ ุฃู ุงูุชุนูููุงุช\n\nุจูุงูุญุงูุฉ:\nโข ุงูุญุณุงุจ ูููู ููุญุธุฑ\nโข ุงูุฃุฑุจุงุญ ุจุชุถูุน\nโข ููุง ูู ุฃู ุฌูุฉ ุจุชุนููุถ ุงูุฎุณุงุฑุฉ\n\nูุญูุง ุจูุดุฑุญ ุงูุทุฑููุฉ ุงูุตุญ ุฎุทูุฉ ุจุฎุทูุฉุ ูุงูุงูุชุฒุงู ุจุงูุชุนูููุงุช ูุณุคูููุฉ ุงููุณุชุฎุฏู ุจุงููุงูู.'
    },
    {
        id: 'faq_3_money_source',
        title: '3๏ธโฃ ูู ููู ุงููุตุงุฑูุ ูููุด ุจูุฏูุนูุงุ',
        content: 'ุงููุตุงุฑู ุจุชุฌู ูุฃูู ุนู ุชูููุฐ ุทูุจ ุจุณูุท.\nูู ุนุฑูุถ ุจุชุทูุจ ููู ุชูุฒูู ุชุทุจูู ุฃู ูุนุจุฉุ ุชูุชุญูุงุ ุฃู ุชูุตู ูููุง ููุฑุญูุฉ ูุนูููุฉ.\n\nููุง ุชุนูู ุงููุทููุจ ุตุญุ ุจููุญุณุจ ุฅูู ุฑุจุญ ูุจุงุดุฑ ุนูู ูุงูุนุฑุถุ ุจุฏูู ูุง ุชุฏูุน ุดู ูู ุฌูุจุชู.\n\nโ ุทูุจ ููุด ุจูุฏูุนูุงุ\nุตุงุญุจ ุงูุชุทุจูู ุฃู ุงููุนุจุฉ ุจุฏู ูุงุณ ุญููููุฉ ุชุณุชุฎุฏู ุงูุชุทุจูู.\nููู ูุงูุงุณุชุฎุฏุงู ูู:\nโข ุจูุฒูุฏ ุนุฏุฏ ุงููุณุชุฎุฏููู\nโข ูุจูุฎุชุจุฑ ุงูุชุทุจูู\nโข ูุจูุทูุน ุฃุฑุจุงุญ ูู ุงูุฅุนูุงูุงุช ููู ุบูุบู ุฃุฏุณูุณ ุฏุงุฎู ุงูุชุทุจูู\n\nูููู ุจููุถูู ูุฏูุนูู ููุงุจู ุฅูู ุชูุฒูู ูุชุณุชุฎุฏู ุงูุชุทุจููุ ุฅูุช ุจุชุณุชููุฏ ูุตุงุฑู ููู ุจูุณุชููุฏ ูู ุงูุงุณุชุฎุฏุงู ูุงูุฅุนูุงูุงุช.'
    },
    {
        id: 'faq_4_proxy_importance',
        title: '4๏ธโฃ ููุด ุงูุจุฑููุณู ูููุ',
        content: '๐ฐ ุฒูุงุฏุฉ ุงูุฏุฎู ุจุดูู ูุจูุฑ:\nุฅุฐุง ุจุฏู ุชุญุตู ุนูู ุฏุฎู ุนุงูู ูู ุงูุชุทุจููุงุช ูุงูููุงูุนุ ุงูุจุฑููุณู ุฃุณุงุณู.\n\nุจุฏูู ุจุฑููุณูุ ูููู ุชุดุชุบู ุดูุฑ ูุงูู ูุชุฌุฑุจ ููุง ุชุทูุน ุฏููุงุฑ ูุงุญุฏุ ูุฃู ุงููุนูู ูุนุทู ูุจุงูุบ ุตุบูุฑุฉ ุฌุฏูุง ููุดุบูุงููู ูู ุฏูู ุนุฑุจูุฉุ ููุงุฑูุฉ ุจูุง ูุนุทูู ููุฃุดุฎุงุต ูู ุฏูู ุฃุฌูุจูุฉ ูููุฉ ุงูุชุตุงุฏููุง ูุซู ุฃูุฑููุง ุฃู ุฃูุฑูุจุง.\n\n๐ป ุดุบูู ุจุฏูู ุจุฑููุณู:\nุจุชูุฏุฑ ุชุดุชุบู ุจุฏูู ุจุฑููุณูุ ุจุณ ุบุงูุจูุง ุงูุฃุฑุจุงุญ ููููุฉ ุฌุฏูุง.\nูู ูุฌููุฏู ุฑุญ ูุฑูุญ ุชูุฑูุจูุง ุนูู ููุงู ูุง ุชูุญุชุณุจ ุฃู ุจูุฑุฏูุฏ ุถุนูู ุฌุฏูุง.\n\nโ ููุงุฆุฏ ุงูุจุฑููุณู:\nโข ุจูุนุทูู ุงููุฏุฑุฉ ุนูู ุงูุฏุฎูู ูุฃูู ูู ุฏููุฉ ุฃุฌูุจูุฉ ูููุฉุ ูุจุชุฒูุฏ ูุฑุตู ุจุงูุญุตูู ุนูู ุงูููุงู ุงููุฏููุนุฉ ุจุงููุงูู.\nโข ุจูุฑูุน ูุฑุฏูุฏู ุจุดูู ูุจูุฑ ูุจูุถูู ุฅูู ูู ูููุฉ ุชุนูููุง ุชุญุณุจ ูุชุฏูุนูู ููุง ูุฌุจ.\n\nุงูุฎูุงุตุฉ:\nุจุฏูู ุจุฑููุณู: ุฏุฎู ูููู ุฌุฏูุง.\nูุน ุจุฑููุณู ููุซูู: ุฏุฎู ูุถูููุ ุขููุ ููุฑุฏูุฏู ุนุงูู ุญุณุจ ูุฌููุฏู.'
    },
    {
        id: 'faq_5_why_my_proxy',
        title: '5๏ธโฃ ููุด ููุถู ุชุณุชุฎุฏู ุจุฑููุณู ูู ุนูุฏูุ',
        content: '1. ุงูุฎุจุฑุฉ ูุงูุชุฌุฑุจุฉ:\nุฃูุง ุนู ุงุณุชุฎุฏู ุงูุจุฑููุณู ูุฌุฑุจู ุน ูู ุงูุชุทุจููุงุช ูุงูููุงูุน ูุจู ูุง ุงูุตุญู ููู.\nุงูุชุทุจููุงุช ุงูุฃุฌูุจูุฉ ูุงูุนุฑุจูุฉ ูู ูุญุฏุฉ ุฅููุง ูุธุงู ูุฑุงูุจุฉ ูุฎุชููุ ููู ุฃููุงุน ุจุฑููุณู ูุญุฏุฏุฉ ูุงุฒู ุชุชูุงูู ูุนุง ูุชูุฌุญ ุงูููุงู ููุญุชู ุชุถูู ุงูู ุงูุฏูุน ุฑุญ ููุตูู.\n\nูุนูู ุงูุจุฑููุณู ููู ุนู ุชุงุฎุฏู ูุฌุฑุจ ุจุนูุณ ุฃู ุจุฑููุณู ูุฌุงูู ุฃู ุนุดูุงุฆู ููู ูููู ูุฎุณุฑู ูู ูุฌููุฏู.\n\n2. ุงููููุฒุงุช ุงูุชูููุฉ ููุจุฑููุณู:\nโข ูุฏููุน โ ูุถูุงู ุณุฑุนุฉ ูุฃูุงู ุฃูุถู.\nโข ููุฏู ุฑูุชูุช โ ูู ูุชุฑุฉ ูุบููุฑ ุงููIP ูุชูุงุฏู ุงูุญุธุฑ.\nโข ุบูุฑ ููุดูู โ ูุญููู ูู ูุดู ุงููุดุงุท ุงููุดุจูู ุฃู IP ูุชูุฑุฑ.\nโข ูุชูุงูู ูุน ูู ุงูุชุทุจููุงุช ุงูุนุฑุจูุฉ ูุงูุฃุฌูุจูุฉ โ ูู ุดูุก ุฌุงูุฒ ููุดุบูุ ุจุฏูู ุชุนุจ ุฅุถุงูู.\n\n3. ุงูุณุนุฑ ุงูููุงุณุจ:\nูุฏูู ููุฑูู ุงูุจุฑููุณู ุจุณุนุฑ ูุชูุงุณุจ ูุน ุดุบูู.\nุงููุจุชุฏุฆูู ุฃู ููู ุดุบููู ููููุ ูุง ุจูุถุทุฑูุง ูุฏูุนูุง ุณุนุฑ ูุจูุฑ ููุงุจู ุดุบู ูููู.\n\n4. ุงูุฎูุงุตุฉ:\nุงูุจุฑููุณู ูู ุนูุฏู ูู ูุชูุฌุฉ ุฎุจุฑุฉ ูุชุฌุฑุจุฉ.\nุฃู ุจุฑููุณู ูุฌุงูู ุฃู ุฎุงุฑุฌู ุฃูุง ุบูุฑ ูุณุคูู ุนู ุฃู ุญุธุฑ ุฃู ุฎุณุงุฑุฉ.\n\nโ๏ธ ุงููุฑุงุฑ ุจุงูููุงูุฉ ุฅูู:\nุงููุฑุงุฑ ูุฑุงุฑูุ ุจุณ ุฃู ุจุฑููุณู ุฑุญ ุชุฌูุจู ุฑุญ ูููู ูุฏููุน.\nููู ูุงู ูููู ุงูุฑุจุญ ูููุ ููุช ููุชูู ุฎูุฏ ุดูุฑู ุฏุบุฑูุ ุฃู ุชุนุงู ุฎูุฏ ููุฑุณ ูุฏููุน.\nุงูููุฑุฉ ููู ุฅูู ุชุณุชููุฏ ูุชูุฑุฑ ุจุฑุงุญุชูุ ูุฃูุง ุฏูุฑู ูุถุญูู ุงูุทุฑูู.'
    },
    {
        id: 'faq_6_fees',
        title: '6๏ธโฃ ูู ุฑุณูู ุบูุฑ ุงูุจุฑููุณูุ',
        content: 'ูุง.\n\nโ ุงูุชูุณูู ูุฌุงูู 100%\nโ ุงูุดุฑุญ ูุฌุงูู\nโ ุงูุชูุฌูู ูุฌุงูู\n\nุงููุฏููุน ุงููุญูุฏ ูู ุณุนุฑ ุงูุจุฑููุณู ููุท.'
    },
    {
        id: 'faq_7_earnings',
        title: '7๏ธโฃ ูุฏูุด ูููู ุทุงูุนุ',
        content: 'ูุง ูู ุฑูู ุซุงุจุช.\nุงูุฑุจุญ ุจูุนุชูุฏ ุนูู:\nโข ููุน ุงููููุฉ\nโข ููุช ุงูุชูููุฐ\nโข ุณุฑุนุชู ูุงูุชุฒุงูู\n\nูููู ุชุงุฎุฏ ูู ูููุฉ ุจ5 ุฏูุงูู 1 ุฏููุงุฑุ ููููู ูููุฉ ุชุงุฎุฏ ุณุงุนุฉ ูู ููุชู ูุชุงุฎุฏ ูุต ุฏููุงุฑ.\n\n๐ธ ุจุดูู ุชูุฑูุจู:\nุจุนุฏ ุงูุชุนูู ูุฅุชูุงู ุงูุดุบูุ ุงููุฑุฏูุฏ ุจูุชุฑุงูุญ ุนุงุฏุฉ ุจูู **$3 ู $7 ููููุงู**.\nุจุดุบู ุจูุชุฑุงูุญ ูุงุจูู 4 ูู 8 ุณุงุนุงุช.\nูููู ุจุชุนุชูุฏ ุนููู ุงูุช ููู ุฑุญ ุชุดุชุบู ูุชูุณู ููุชู ูููู ุดุทุงุฑุชู ูุชูุธุฑ ููุดุบู ุน ุงูู ุดุบู ูู ููุงู ูุชุถูุน ููุชู โค๏ธ'
    },
    {
        id: 'faq_8_countries',
        title: '8๏ธโฃ ูููู ุฃุดุชุบู ูู ุฃู ุจูุฏุ',
        content: 'ูุนูุ ุงูุดุบู ูุชุงุญ ุจูุงูุฉ ุงูุฏูู.'
    },
    {
        id: 'faq_9_security',
        title: '9๏ธโฃ ูู ูู ุฎุทุฑ ุนูู ูุนูููุงุชูุ',
        content: 'ูุง.\n\nโข ูุง ุจูุทูุจ ูุนูููุงุช ุจูููุฉ\nโข ูุง ุจูุทูุจ ุจูุงูุงุช ุดุฎุตูุฉ\nโข ูู ุงููุญุชูู ูุฌุฑูุจ ูุขูู\n\nุณูุงูุชู ุงูุฑูููุฉ ูุงุฌุจ ุนููู ุณุงุนุฏู ููุง ุงุตูุง ุจุงูููุงุฉ ุจูุดุฑ ุงู ุดู ุจูููู ููู ุดู ูู ูุธุงูู.'
    },
    {
        id: 'faq_10_arab_apps',
        title: '๐ ุงูุดุบู ุนูู ุงูููุงูุน ุงูุนุฑุจูุฉ',
        content: 'โ ุงูุฏูุน ูุถููู ุจูุณุจุฉ ูุจูุฑุฉ\n๐ก ุงูููุงู ุณููุฉ ููุงุถุญุฉ ููุง ุจุฏูุง ุฎุจุฑุฉ\n๐ณ ุณุญุจ ุณุฑูุน ูุฃู ุญุฏ ุงูุณุญุจ ููุฎูุถุ ุฃุญูุงูุงู ูู $0.1 ููุท\n๐ต ุงูุฏุฎู ุจูุนุชูุฏ ุนูู ุงูุชุฒุงูู ูุงุณุชูุฑุงุฑู\n๐ค ููุฒุฉ ูููุฉ: ุฃุบูุจ ุงูุชุทุจููุงุช ุงูุนุฑุจูุฉ ุฃุตุญุงุจูุง ูุนุฑููููุ ููู ุนูุฏู ุฅููุงููุฉ ุชูุงุตู ูุจุงุดุฑ ูุนู ุนูุฏ ุฃู ูุดููุฉ\n๐ฏ ููุงุณุจุฉ ุฌุฏุงู ูููุจุชุฏุฆูู ููู ุจุฏูู ูุจููุง ุฏุฎู ุฌุงูุจู ุขูู ููุถููู'
    },
    {
        id: 'faq_11_foreign_apps',
        title: '1๏ธโฃ1๏ธโฃ ุงูุดุบู ุนูู ุงูููุงูุน ุงูุฃุฌูุจูุฉ',
        content: '๐ต ุฏุฎู ุฃุนูู ููุงุฑูุฉ ุจุงูุชุทุจููุงุช ุงูุนุฑุจูุฉ\n๐ ุดุบู ูุฑุชุจ ูููุธู ูููู ูุญุชุงุฌ ุฏูุฉ ูุงูุชุฒุงู\n๐ณ ุญุฏ ุงูุณุญุจ ุบุงูุจุงู ูุจุฏุฃ ูู $3 ููุง ููู (ุญุณุจ ุงููููุน ุฃู ุงูุชุทุจูู)\n๐ฏ ููุงุณุจุฉ ููุฃุดุฎุงุต ุงูุฌุงุฏูู ููู ุจุฏูู ูุจููุง ุฏุฎู ุฑููู ุญูููู ุจุฎุทูุงุช ูุญุณูุจุฉ ูุจุฏูู ุนุดูุงุฆูุฉ'
    },
    {
        id: 'faq_12_common_points',
        title: '2๏ธโฃ1๏ธโฃ ุงูููุงุท ุงููุดุชุฑูุฉ ูุงููุฑู',
        content: '๐ ูุงุฒู ุงุณุชุฎุฏุงู ุจุฑููุณู ุฃููุฑูู\nโฐ ุถุจุท ุงูุชูููุช ุญุณุจ ุชูููุช ุงูุจุฑููุณู\n๐ ุถุจุท ุงููุบุฉ ุจูุง ูุชูุงูู ูุน ูููุน ุงูุจุฑููุณู\n๐ก๏ธ ูุงูุฅุนุฏุงุฏุงุช ุถุฑูุฑูุฉ ูุณูุงูุฉ ุงูุญุณุงุจ ูุชุฌููุจ ุงูุญุธุฑ ุฃู ุฑูุถ ุงูุฃุฑุจุงุญ\n\nุงูุฅุนุฏุงุฏุงุช ุงูุชูููุฉ ูุงุญุฏุฉ ููุฌููุน\nุงููุฑู ุงูุญูููู ูู ุจุทุจูุนุฉ ุงูุดุบูุ ูู ุจุงูุฅุนุฏุงุฏุงุช\n\nููุง ูุจููุด ููุถุจุท ุงูุดุบู ุงูุฃุฌูุจู ุจุดูู ุตุญูุญ:\n๐ ูููู ุนูููุงู ุฎุชููุง ุงููุฌุงู ูุงูู\nุณูุงุก: ุดุบู ุนุฑุจู ุฃู ุดุบู ุฃุฌูุจู\n\nูุฃู: ุงูุดุฑุญ ูุงุญุฏ ุงูุฅุนุฏุงุฏุงุช ูุงุญุฏุฉ ุงูููุงุนุฏ ุงูุฃุณุงุณูุฉ ููุณูุง\n\nุงููุฑู ุงููุญูุฏ:\n๐ ุงูุดุบู ุงูุฃุฌูุจู ุดุฑุญู ุฃุนูู\n๐ ุจุฏู ุชุฏููู ุจูู ุชูุตูู\n๐ ุฃู ุฎุทุฃ ูููู ูุณุจุจ ุฑูุถ ุฃู ุญุธุฑ\n\n๐ ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ\nุงูุฅุนุฏุงุฏุงุช (ุจุฑููุณู โ ุชูููุช โ ูุบุฉ): ุซุงุจุชุฉ ููุฌููุน\nุงูุนุฑุจู: ุฃุณููุ ุฃุฃููุ ุณุญุจ ุฃุณุฑุน\nุงูุฃุฌูุจู: ูุณุชูู ุงุญุชุฑุงููุ ูุฑุฏูุฏ ุฃุนููุ ูุญุชุงุฌ ุงูุชุฒุงู\n\n๐ ุงููู ุจูููู ุงูุฃุฌูุจู ุตุญ ๐ ุงูุนุฑุจู ุจุตูุฑ ุณูู ุฌุฏุงู ุนููู'
    },
    {
        id: 'faq_13_foreign_preference',
        title: '3๏ธโฃ1๏ธโฃ ููุด ุจูุถูู ุงูุฃุฌูุจูุ',
        content: 'ุตุญูุญ ุฅูู ุงูุดุบู ุน ุงูุฃุฌูุจู ููู ูุณุจุฉ ูุฎุงุทุฑุฉ ุฃุนูู ุฅุฐุง ูุง ูุงู ุงูุดุบู ูุธุจูุทุ ููู ุจุงูููุงุจู ููู ููุงุท ุฃููู ููุฑุฏูุฏ ุฃุนูู.\n\nุงูุฃุฌูุจู:\nโข ุฃุฑุจุงุญู ุฃุนูู\nโข ุงูููุงู ุฃุนูู ูููุฉ\nโข ุงูุฃูุธูุฉ ุฃุฏู\n\nูุนูู ุงุฐุง ุจุชูุชุฒู ุตุญ = ุฏุฎู ุฃููู'
    },
    {
        id: 'faq_14_start_steps',
        title: '4๏ธโฃ1๏ธโฃ ูููุช ูุญุงุจุจ ุจูุดุ',
        content: '๐ฑ ุชุญููู ุงูุชุทุจููุงุช ุงูุฃุณุงุณูุฉ\n\nุฃูู ุฎุทูุฉ ูุงุฒู ุชุญููู ูู ุงูุชุทุจููุงุช ุงููุทููุจุฉ ูู ุงูุฑุงุจุท ุงูุชุงูู:\n\n๐ [ุงุถุบุท ููุง ูุชุญููู ุงูุชุทุจููุงุช](https://t.me/L2w_11/4)\n\n(ุงูุชุทุจููุงุช ุฌุงูุฒูู ุจูุงูุฑุงุจุทุ ูุญุงุทุช ุงุณูุงุก ูุดูู ุงูุชุทุจููุงุช ูุงูุชุทุจููุงุช ููู ููุฌูุฏูู ุจ ูุชุฌุฑ play)'
    }
];

// Initialize DB if not exists
if (!fs.existsSync(DB_FILE)) {
    const initialData = {
        sections: FIXED_SECTIONS
    };
    fs.writeFileSync(DB_FILE, JSON.stringify(initialData, null, 2));
}

function readDb() {
    if (!fs.existsSync(DB_FILE)) {
        // Fallback if file deleted mid-run
        return { sections: FIXED_SECTIONS };
    }
    const data = fs.readFileSync(DB_FILE);
    try {
        return JSON.parse(data);
    } catch (e) {
        return { sections: FIXED_SECTIONS };
    }
}

function writeDb(data) {
    fs.writeFileSync(DB_FILE, JSON.stringify(data, null, 2));
}

function getSections() {
    const db = readDb();

    // Auto-Repair: If DB has default old data or empty, restore FIXED_SECTIONS
    // This solves the render restart issue
    if (!db.sections || db.sections.length < 3 || db.sections[0].id === 'cpa_intro') {
        db.sections = FIXED_SECTIONS;
        writeDb(db);
    }

    return db.sections;
}

function addSection(title, content) {
    const db = readDb();
    const id = Date.now().toString();
    db.sections.push({ id, title, content });
    writeDb(db);
    return id;
}

function deleteSection(id) {
    const db = readDb();
    const initialLength = db.sections.length;
    db.sections = db.sections.filter(s => s.id !== id);
    writeDb(db);
    return db.sections.length < initialLength;
}

function updateSection(id, newContent) {
    const db = readDb();
    const section = db.sections.find(s => s.id === id);
    if (section) {
        section.content = newContent;
        writeDb(db);
        return true;
    }
    return false;
}

function moveSection(id, direction) {
    const db = readDb();
    const index = db.sections.findIndex(s => s.id === id);
    if (index === -1) return false;

    if (direction === 'up' && index > 0) {
        // Swap with previous
        [db.sections[index - 1], db.sections[index]] = [db.sections[index], db.sections[index - 1]];
        writeDb(db);
        return true;
    } else if (direction === 'down' && index < db.sections.length - 1) {
        // Swap with next
        [db.sections[index + 1], db.sections[index]] = [db.sections[index], db.sections[index + 1]];
        writeDb(db);
        return true;
    }
    return false;
}

function getSection(id) {
    const db = readDb();
    return db.sections.find(s => s.id === id);
}

function getQuizzes() {
    const db = readDb();
    return db.quizzes || [];
}

function getQuiz(id) {
    const db = readDb();
    return db.quizzes.find(q => q.id === id);
}

// Deprecated but kept for safety if needed, though migration handles it
function getProxyText() {
    const db = readDb();
    return db.proxyText || "โ๏ธ ูู ูุชู ุชุนููู ูุต ูุฎุตุต ูุทูุจ ุงูุจุฑููุณู ุจุนุฏ.";
}

function setProxyText(text) {
    // Legacy support: add or update section named 'ูุทูุจ ุจุฑููุณู'
    const db = readDb();
    const section = db.sections.find(s => s.title === 'ูุทูุจ ุจุฑููุณู');
    if (section) {
        section.content = text;
    } else {
        db.sections.push({
            id: 'proxy_request_' + Date.now(),
            title: 'ูุทูุจ ุจุฑููุณู',
            content: text
        });
    }
    delete db.proxyText;
    writeDb(db);
}

module.exports = {
    getSections,
    addSection,
    deleteSection,
    updateSection,
    moveSection,
    getSection,
    getQuizzes,
    getQuiz,
    getProxyText,
    setProxyText
};
